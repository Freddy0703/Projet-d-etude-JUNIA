<!DOCTYPE html>
<html lang="fr">
<head>
  <meta charset="UTF-8">
  <title>Dashboard Administrateur</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css" rel="stylesheet">
  <style>
    body { display: flex; }
    .sidebar {
      width: 250px;
      height: 100vh;
      background-color: #343a40;
      color: white;
      position: fixed;
    }
    .sidebar a {
      display: block;
      padding: 12px;
      color: white;
      text-decoration: none;
    }
    .sidebar a:hover {
      background-color: #495057;
    }
    .content {
      margin-left: 250px;
      padding: 20px;
      width: 100%;
    }
  </style>
</head>
<body>

  <!-- Sidebar -->
  <div class="sidebar">
    <h4 class="text-center py-3">Administrateur</h4>
    <a href="/administrateur/dashboard">Dashboard</a>
    <a href="/administrateur/patients">Patients</a>
    <a href="/administrateur/dossiers">Dossiers médicaux</a>
    <a href="/administrateur/examens">Examens</a>
    <a href="/administrateur/utilisateurs">Utilisateurs</a>
    <a href="/administrateur/historique">Historique connexions</a>
    <a href="/administrateur/parametres">Paramètres</a>
    <a href="/deconnexion">Déconnexion</a>
  </div>

  <!-- Contenu principal -->
  <div class="content">
    <!-- Profil admin -->
    <div class="card mb-4">
      <div class="card-body d-flex align-items-center">
        <img id="photoProfil" src="../images/default.png" alt="Photo de profil" class="rounded-circle me-3" width="80" height="80">
        <div>
          <h5 id="nomComplet" class="card-title"></h5>
          <p id="email" class="card-text"></p>
          <span id="role" class="badge bg-success"></span>
        </div>
      </div>
    </div>

    <!-- Statistiques globales -->
    <div class="row text-center mb-4">
      <div class="col-md-3">
        <div class="card text-bg-primary">
          <div class="card-body">
            <h5>Patients</h5>
            <p id="patientsCount" class="fs-3">0</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-bg-success">
          <div class="card-body">
            <h5>Médecins</h5>
            <p id="medecinsCount" class="fs-3">0</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-bg-warning">
          <div class="card-body">
            <h5>Secrétaires</h5>
            <p id="secretairesCount" class="fs-3">0</p>
          </div>
        </div>
      </div>
      <div class="col-md-3">
        <div class="card text-bg-danger">
          <div class="card-body">
            <h5>Dossiers médicaux</h5>
            <p id="dossiersCount" class="fs-3">0</p>
          </div>
        </div>
      </div>
    </div>

    <!-- Derniers médecins inscrits -->
    <h4>Derniers Médecins inscrits</h4>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Email</th>
          <th>Date de connexion</th>
        </tr>
      </thead>
      <tbody id="lastMedecins"></tbody>
    </table>

    <!-- Derniers secrétaires inscrits -->
    <h4>Derniers Secrétaires inscrits</h4>
    <table class="table table-striped">
      <thead>
        <tr>
          <th>Nom</th>
          <th>Prénom</th>
          <th>Email</th>
          <th>Date de connexion</th>
        </tr>
      </thead>
      <tbody id="lastSecretaires"></tbody>
    </table>
  </div>

  <script>
    // Charger les données du backend
    fetch('/api/admin/dashboard')
      .then(res => res.json())
      .then(data => {
        // Profil
        document.getElementById('photoProfil').src = "../images/" + data.user.photoProfil;
        document.getElementById('nomComplet').innerText = data.user.prenom + " " + data.user.nom;
        document.getElementById('email').innerText = "Email : " + data.user.login;
        document.getElementById('role').innerText = data.user.role;

        // Statistiques
        document.getElementById('patientsCount').innerText = data.stats.totalPatients;
        document.getElementById('medecinsCount').innerText = data.stats.totalMedecins;
        document.getElementById('secretairesCount').innerText = data.stats.totalSecretaires;
        document.getElementById('dossiersCount').innerText = data.stats.totalDossiers;

        // Derniers médecins
        const medecinsTable = document.getElementById('lastMedecins');
        data.medecins.forEach(m => {
          medecinsTable.innerHTML += `<tr>
            <td>${m.nom}</td>
            <td>${m.prenom}</td>
            <td>${m.login}</td>
            <td>${m.dateConnexion || ''}</td>
          </tr>`;
        });

        // Derniers secrétaires
        const secretairesTable = document.getElementById('lastSecretaires');
        data.secretaires.forEach(s => {
          secretairesTable.innerHTML += `<tr>
            <td>${s.nom}</td>
            <td>${s.prenom}</td>
            <td>${s.login}</td>
            <td>${s.dateConnexion || ''}</td>
          </tr>`;
        });
      });
  </script>
</body>
</html>
